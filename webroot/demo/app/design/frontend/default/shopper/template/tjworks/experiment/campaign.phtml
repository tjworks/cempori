
<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" xmlns:fb="http://www.facebook.com/2008/fbml"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <?php echo $this->getChildHtml('head') ?>
  
  <style>
    body {
      padding:0px;
      margin:0px;
    }
    
  </style>
</head>

<body class="<?php echo $this->getBodyClass()?' '.$this->getBodyClass().'':'' ?><?php echo Mage::getStoreConfig('shoppersettings/design/responsive') ? '': ' non-responsive ' ?>">
 

<?php
//$_productCollection=$this->getLoadedProductCollection();

// list all products
$_productCollection = Mage::getResourceModel('catalog/product_collection')->addAttributeToSort('entity_id', 'DESC');
//$_productCollection = Mage::getModel("catalog/product")->getCollection()->addAttributeToSort('id', 'DESC');

$is_story = False;


$_helper = $this->helper('catalog/output');
$helper = $this->helper('shoppersettings/image');

$cms_id = $this->helper('shoppersettings')->getCurrentCmsPage();
if ( !$cms_id ) {
    $pageLayout = $this->getLayout()->getBlock('root')->getTemplate();
    if ( strpos($pageLayout, '2columns') ) {
        $grid_class = 'two_columns_' . Mage::getStoreConfig('shoppersettings/catalog/grid_columns_2col');
    } else {
        $grid_class = 'one_column_' . Mage::getStoreConfig('shoppersettings/catalog/grid_columns_1col');
    }
} else {
    if ( $cms_id == 'shopper_home' ) {
        $grid_class = 'one_column_' . Mage::getStoreConfig('shoppersettings/catalog/grid_columns_1col');
    } else {
        $grid_class = 'two_columns_' . Mage::getStoreConfig('shoppersettings/catalog/grid_columns_2col');
    }
}

$item_type= "product";
$imgX = 252;
$imgY = $helper->calculateHeight($imgX);

$skipped = 0;
$count = 0;
?>
<div  style="width:700px;margin:auto">
  
    <img src="/media/email/logo/default/logo-banner.png" style="width:580px;margin-bottom:40px" align="center"/>
  
    <?php $_collectionSize = $_productCollection->count(); ?>
 
    <table class="campaign-table" style="margin:auto">
    <?php foreach ($_productCollection as $_product): ?>
      
        <?php 
          
          $this->helper('shoppersettings')->getLabel($_product);  // seems make a call would load the extra data
          $is_story =  strlen($_product->getData("author"))>0;
          if( $_product->getVisibility() == 1 || !$_product->isSaleable())  // Not Visible
            continue;
          $is_licensed = False;
          if(strlen($_product->getData("lr_brand"))>0){
            $is_licensed = True; 
          }
          $count = $count+1;
          if($count >4) break;
          if($count == 1 || $count == 3)
            echo "<tr>";  
        ?>
        
        <td class="item">
            <ul class="products-grid">
              
            <li class="item">
            <div class="regular">
                                
                <a href="<?php echo $is_story?"stories":""?>/<?php echo basename($_product->getProductUrl()) ?>" title="<?php echo $this->htmlEscape($_product->getName()) ?>" class="product-image">
                    <?php echo $this->helper('shoppersettings')->getLabel($_product);  ?>
                    <img src="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize($imgX, $imgY) ?>" data-srcX2="<?php echo $this->helper('catalog/image')->init($_product, 'small_image')->resize($imgX*2, $imgY*2) ?>" width="<?php echo $imgX; ?>" height="<?php echo $imgY; ?>" alt="<?php echo $this->htmlEscape($_product->getName()) ?>" />

                    <?php if($is_licensed):?>
                      <img src="/media/site/icon-exclusive.png" style=" position:absolute;top:0px;left:0;">
                    <?php endif?>                     
                </a>
                
                <?php if($is_story): ?>
                    <div style="position:absolute;top:0;left:0;z-index:2"><img src="/media/site/icon-story-banner.png"></div>
                <?php endif?>
                <div class="product-info">
                    <?php if  (! $is_story ):?>
                        <div class="button-container">
                            <?php if($_product->isSaleable()): ?>
                            <?php if (Mage::getStoreConfig('shoppersettings/ajax/cart')) : ?>
                                <?php if ( !($_product->getTypeInstance(true)->hasRequiredOptions($_product) || $_product->isGrouped()) ) { ?>
                                    <p><button type="button" title="<?php echo $this->__('Add to Cart') ?>" class="button btn-cart ajax-cart" data-url="<?php echo $this->getAddToCartUrl($_product); ?>" data-id="<?php echo $_product->getId(); ?>"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button></p>
                                    <?php } else { ?>
                                    <p><button type="button" title="<?php echo $this->__('Add to Cart') ?>" class="button btn-cart show-options" data-id="<?php echo $_product->getId(); ?>"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button></p>
                                    <?php }  ?>
                                <?php else: ?>
                                <p><button type="button" title="<?php echo $this->__('Add to Cart') ?>" class="button btn-cart" onclick="setLocation('<?php echo $this->getAddToCartUrl($_product) ?>')"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button></p>
                                <?php endif; ?>
                            <?php else: ?> 
                            <p class="availability out-of-stock"><span><?php echo $this->__('Out of stock') ?></span></p>      
                              
                            <?php endif; ?>
                        </div>
                        
                  <?php endif; ?>
                    
                    <?php $_productNameStripped = $this->stripTags($_product->getName(), null, true); ?>
                    <a class="product-name" href="<?php echo $_product->getProductUrl() ?>" title="<?php echo $_productNameStripped; ?>"><?php echo $_helper->productAttribute($_product, $_product->getName() , 'name'); ?></a>
                       
                    <?php if  (! $is_story ):?>
                          <?php echo $this->getPriceHtml($_product, true) ?>
                    <?php else: ?>
                          <p class="author-name"><span><?php echo $_product->getData("author")?></span></p>
                    <?php endif;?>
                    
                </div>
            </div>
            </li>
            </ul>
            
        </td>
    <?php if($count == 2 || $count == 4)
            echo "</tr>";
    ?>
    <?php endforeach ?>
    </table>
</div>



</body>
</html>